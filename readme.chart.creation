## Updated reusable prompt with split legends

> I am providing:
>
> 1. A CSV with:
>
> * `Timestamp` (MM/DD/YYYY h:mmam/pm)
> * `Error Count` (numeric)
> * multiple `error_*_1h` columns
>
> 2. `SYSTEM_NOTES.md` containing version history, incidents, and modifications with dated entries.
>
> Build the **Coverage-Normalized Daily Average Error Trend** as follows:
>
> ### Metric (Coverage-normalized, regularized)
>
> 1. Parse `Timestamp` using explicit format: `"%m/%d/%Y %I:%M%p"`.
> 2. Exclude the current partial day if specified (ignore `2025-12-14`).
> 3. Identify error streams = all columns matching `error_*_1h`.
> 4. For each stream, compute `first_seen(stream)` = first date where stream value > 0.
> 5. For each day `d`, compute:
>    `coverage(d) = active_streams(d) / total_streams`
>    where `active_streams(d)` are streams with `first_seen ≤ d`.
> 6. Compute `daily_avg(d) = mean(Error Count on day d)`.
> 7. Compute coverage-normalized daily average:
>    `cn_avg(d) = daily_avg(d) / coverage(d)`
> 8. Regularize scale:
>    `cn_norm(d) = cn_avg(d) / 100000`
>    so **100,000 errors = 1.0**.
> 9. Compute a visual-only smoothed line:
>    3-day centered rolling mean of `cn_norm(d)`.
>
> ### Chart
>
> * X-axis: Day
> * Y-axis label: “Coverage-Normalized Daily Average Error Count (100k = 1)”
> * Plot:
>
>   * Solid: `cn_norm(d)`
>   * Dashed: smoothed `cn_norm(d)`
>
> ### SYSTEM_NOTES overlay (events)
>
> Parse `SYSTEM_NOTES.md` and extract overlay events from:
>
> * `## vX.Y.Z (YYYY-MM-DD) — Title`  → category **Version**
> * `## YYYY-MM-DD — Title`           → category **Incident/Modification**
> * `*YYYY-MM-DD: Title*`             → category **Note** (optional; include only if present and not too noisy)
>
> For each event date that falls within the chart’s date range:
>
> * Draw a vertical dashed marker at that date
> * Put a single letter at the top of the marker (A, B, C… in chronological order across ALL included events)
> * Color-code markers by category (Version vs Incident/Modification vs Note)
>
> ### Legend formatting (IMPORTANT)
>
> Keep the chart readable by using **two separate legends**:
>
> 1. Legend #1 (top-left): ONLY the two main series:
>
>    * Daily Avg (Coverage-normalized, 100k=1)
>    * Smoothed (3-day)
> 2. Legend #2 (top-right OR outside plot if needed): Events, grouped in two blocks:
>
>    * **Versions:** list `Letter: Title`
>    * **Incidents/Modifications:** list `Letter: Title`
>    * (Optional) **Notes:** list `Letter: Title` only if there are few; otherwise omit Notes from legend and output them as a table only.
>
> Letters should appear on-chart; full titles only in legends/tables.
>
> ### Output requirements
>
> * Display the chart
> * Save as a downloadable PNG
> * Print a table with columns: `[Letter, Date, Category, Title]`
> * Clearly state in the output:
>
>   * “Coverage-normalized”
>   * “Regularized: 100k errors = 1.0”
>   * “Ignored 2025-12-14” (or whatever ignore date is specified)
>
> If anything is ambiguous, ask before proceeding.

---

If you want, I can also tweak it so the **event legend auto-switches to a “callout list” below the chart** once you exceed (say) 10 events, so it never becomes a wall of text.
